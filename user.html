<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="imgs/icon.png">
  <link rel="stylesheet" href="css/user.css" />
  <title>ููุญุฉ ุงููุณุชุฎุฏู</title>
</head>
<body>
  <!-- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ -->
  <aside class="sidebar" id="sidebar">
    <div class="logo" title="ุฏุงุนู - ุงูุฏุนู ุงูููุณู">ุฏุงุนู</div>
    <nav>
      <a href="#" data-section="clinic" class="active"><i class="fas fa-clinic-medical"></i><span>ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</span></a>
      <a href="#" data-section="chat"><i class="fas fa-comments"></i><span>ุฌูุณุฉ ุงููุญุงุฏุซุฉ</span></a>
      <a href="#" data-section="resources"><i class="fas fa-book"></i><span>ุงูููุงุฑุฏ ุงูููุณูุฉ</span></a>
      <a href="#" data-section="ai-log"><i class="fas fa-book"></i><span>ุณุฌูุงุช ุงููุฒุงุฌ</span></a>
      <a href="#" data-section="ai-suggestions"><i class="fas fa-robot"></i><span>ุงูุชุฑุงุญุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู</span></a>
      <a href="#" data-section="user-data"><i class="fas fa-user-circle"></i><span>ุจูุงูุงุช ุงููุณุชุฎุฏู</span></a>
      <a href="#" data-section="analysis"><i class="fas fa-brain"></i><span>ุชุญููู ุงูุญุงูุฉ ุงูููุณูุฉ</span></a>
      <a href="#" data-section="support-sessions"><i class="fas fa-headset"></i><span>ุฌูุณุงุช ุงูุฏุนู</span></a>
    </nav>
    <button class="toggle-btn" id="toggleSidebar" title="ุทู ุงููุงุฆูุฉ">&#9776;</button>
  </aside>

  <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
  <main class="main-content">

    <!-- ุฑุฃุณ ุงูุตูุญุฉ -->
    <header>
      <div class="profile" id="profileToggle">
        <span>ูุฑุญุจุงุ ูุญูุฏ</span>
        <img src="https://i.pravatar.cc/150?img=47" alt="ุตูุฑุฉ ุงูููู ุงูุดุฎุตู" />
        <div class="profile-menu" id="profileMenu">
          <a href="#" data-section="user-data">ุงูููู ุงูุดุฎุตู</a>
          <a href="#" id="logout">ุชุณุฌูู ุงูุฎุฑูุฌ</a>
        </div>
      </div>
    </header>

      <!-- ููุฏูุฉ ุงูุนูุงุฏุฉ ุงูููุณูุฉ -->
  <section class="clinic-intro section active-section" id="clinic">
    <div class="clinic-content">
      <h1>ูุฑุญุจูุง ุจู ูู ุนูุงุฏุฉ ุฏุงุนู ุงูููุณูุฉ </h1>
      <p>ูุญู ููุง ููุงุณุชูุงุน ุฅููู ูุชูุฏูู ุงูุฏุนู ุงูููุณู ุจุฑุนุงูุฉ ูุฎุตูุตูุฉ ุชุงูุฉ.<br> ูุชู ุชุฑุบุจ ุฃู ูุจุฏุฃ ุฌูุณุชูุ</p>
      <button class="start-session-btn" onclick="goToSession()">ุงุจุฏุฃ ุงูุฌูุณุฉ</button>
    </div>
  </section>

<section id="chat" class="section">
  <h2 class="section-header">ุฌูุณุฉ ุงููุญุงุฏุซุฉ</h2>
  <div class="chat-container">
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input">
      <textarea id="chatInput" placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..."></textarea>
      <button id="sendBtn" aria-label="ุฅุฑุณุงู ุฑุณุงูุฉ">ุฅุฑุณุงู</button>
    </div>
  </div>
</section>



 
    <section id="ai-log" class="section">
      <h2 class="section-header">ุณุฌู ุงููุฒุงุฌ </h2>
      <div class="ai-log-container" id="aiLogList">
        <div>ุฌุงุฑู ุชุญููู ุงูุณุฌู...</div>
      </div>
    </section>


    <section id="ai-suggestions" class="section">
      <h2 class="section-header">ุงูุชุฑุงุญุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู</h2>
      <div class="ai-suggestions" id="aiSuggestionsList">
      </div>
    </section>

   <!-- ุงูููุงุฑุฏ ุงูููุณูุฉ -->
    <section id="resources" class="section">
      <h2 class="section-header">ุงูููุงุฑุฏ ุงูููุณูุฉ</h2>
      <div class="resources" id="resourcesList">
       
      </div>
    </section>

    <!-- ุจูุงูุงุช ุงููุณุชุฎุฏู -->
    <section id="user-data" class="section">
      <h2 class="section-header">ุจูุงูุงุช ุงููุณุชุฎุฏู</h2>
      <div class="user-data" id="userData">
        <h3>ูุนูููุงุช ุดุฎุตูุฉ</h3>
        <p><strong>ุงูุงุณู:</strong> ูุญูุฏ</p>
        <p><strong>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</strong> dvf@example.com</p>
        <p><strong>ุชุงุฑูุฎ ุงูุชุณุฌูู:</strong> 2025-06-10</p>
      </div>
    </section>

    <!-- ุชุญููู ุงูุญุงูุฉ ุงูููุณูุฉ -->
    <section id="analysis" class="section">
      <h2 class="section-header">ุชุญููู ุงูุญุงูุฉ ุงูููุณูุฉ</h2>
      <div class="analysis" id="analysisResult">
        <h3>ููุฎุต ุงูุชุญููู</h3>
        <p>ุชุญููู ุฃููู ุจูุงุกู ุนูู ุณุฌู ุงููุฒุงุฌ ููุญุงุฏุซุงุชู ูุธูุฑ ุฃู ุญุงูุชู ุงูููุณูุฉ ูุณุชูุฑุฉ ูุน ุจุนุถ ุงูุชูุชุฑ ุงูุฎููู ูู ุจุนุถ ุงูุฃูุงู. ููุตุญ ุจููุงุตูุฉ ุชูุงุฑูู ุงูุงุณุชุฑุฎุงุก ูุงููุชุงุจุนุฉ ูุน ูุฎุชุต ูู ุญุงู ุฒุงุฏุช ุงูุฃุนุฑุงุถ.</p>
      </div>
    </section>


    <!-- ุฌูุณุงุช ุงูุฏุนู -->
    <section id="support-sessions" class="section">
      <h2 class="section-header">ุฌูุณุงุช ุงูุฏุนู</h2>
      <div class="support-sessions">
        <h3>ุงุฎุชุฑ ููุน ุงูุฌูุณุฉ</h3>
        <div class="session-types">
          <div class="session-type" tabindex="0">
            <i class="fas fa-comment-dots"></i>
            <span>ุฌูุณุฉ ูุตูุฉ</span>
          </div>
          <div class="session-type" tabindex="0">
            <i class="fas fa-phone-alt"></i>
            <span>ุฌูุณุฉ ุตูุชูุฉ</span>
          </div>
          <div class="session-type" tabindex="0">
            <i class="fas fa-video"></i>
            <span>ุฌูุณุฉ ูุฑุฆูุฉ</span>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- ุฃููููุงุช ูููุช ุฃูุณูู -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script src="js/user.js"></script>
  
  <script>
    // ุฌูุณุงุช ุงูุฏุนู - ุชูุงุนู ุจุณูุท
    document.querySelectorAll('.session-type').forEach(btn => {
        btn.addEventListener('click', () => {
        alert(`ุชู ุงุฎุชูุงุฑ: ${btn.textContent.trim()}`);
        });
    });
  document.addEventListener("DOMContentLoaded", function () {
  const sidebar = document.getElementById("sidebar");
  const toggleBtn = document.getElementById("menuToggleBtn");
  const overlay = document.getElementById("overlay");

  toggleBtn.addEventListener("click", () => {
    sidebar.classList.toggle("open");
    overlay.classList.toggle("active");
  });

  overlay.addEventListener("click", () => {
    sidebar.classList.remove("open");
    overlay.classList.remove("active");
  });
});


  </script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  const API_BASE_URL = 'https://motasim.pythonanywhere.com/';
  document.addEventListener("DOMContentLoaded", function () {
    // โ 1. ุงูุชุญูู ูู ุงูุชููู
    const token = localStorage.getItem('access');
    if (!token) {
      window.location.href = 'login.html';  // ูู ูุชู ุชุณุฌูู ุงูุฏุฎูู
      return;
    }

    // โ 2. ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู
    fetch(`${API_BASE_URL}/me/`, {
      method: 'GET',
      headers: {
        'Authorization': 'Bearer ' + token
      }
    })
    .then(res => {
      if (!res.ok) {
        throw new Error("ุงูุชูุช ุตูุงุญูุฉ ุงูุฌูุณุฉ");
      }
      return res.json();
    })
    .then(user => {
      // ุนุฑุถ ุงูุจูุงูุงุช
      document.querySelector('#userData').innerHTML = `
        <h3>ูุนูููุงุช ุดุฎุตูุฉ</h3>
        <p><strong>ุงูุงุณู:</strong> ${user.username}</p>
        <p><strong>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</strong> ${user.email}</p>
        <p><strong>ุงูุฏูุฑ:</strong> ${user.role === 'client' ? 'ูุณุชุฎุฏู' : 'ูุนุงูุฌ ููุณู'}</p>
      `;
      document.querySelector('#profileToggle span').textContent = "ูุฑุญุจุงุ " + user.username;
    })
    .catch(err => {
      console.error("ูุดู ูู ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู:", err);
      alert("ุงูุชูุช ุตูุงุญูุฉ ุงูุฌูุณุฉ. ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ูุฌุฏุฏูุง.");
      localStorage.removeItem('access');
      localStorage.removeItem('refresh');
      window.location.href = 'login.html';
    });

    // โ 3. ุชุณุฌูู ุงูุฎุฑูุฌ
    const logoutLink = document.getElementById("logout");

    if (logoutLink) {
      logoutLink.addEventListener("click", function (e) {
        e.preventDefault();

        Swal.fire({
          title: 'ูู ุฃูุช ูุชุฃูุฏุ',
          text: "ุณูุชู ุชุณุฌูู ุงูุฎุฑูุฌ ูู ุงูุฌูุณุฉ ุงูุญุงููุฉ",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'ูุนูุ ุณุฌู ุฎุฑูุฌู',
          cancelButtonText: 'ุฅูุบุงุก'
        }).then((result) => {
          if (result.isConfirmed) {
            localStorage.removeItem('access');
            localStorage.removeItem('refresh');

            Swal.fire({
              icon: 'success',
              title: 'ุชู ุชุณุฌูู ุงูุฎุฑูุฌ',
              text: 'ุณูุชู ุชุญูููู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู...',
              showConfirmButton: false,
              timer: 2000,
              timerProgressBar: true
            }).then(() => {
              window.location.href = 'login.html';
            });
          }
        });
      });
    }
  });
</script>

<script>
  const token = localStorage.getItem('access');

  fetch(`${API_BASE_URL}suggestions/`, {
    method: 'GET',
    headers: {
      'Authorization': 'Bearer ' + token,
      'Content-Type': 'application/json'
    }
  })
  .then(res => {
    if (!res.ok) {
      throw new Error("ูุดู ูู ุชุญููู ุงูุงูุชุฑุงุญุงุช");
    }
    return res.json();
  })
  .then(data => {
    const listContainer = document.getElementById('aiSuggestionsList');
    listContainer.innerHTML = ''; // ุชูุฑูุบ ุงูููุฌูุฏ

    if (data.length === 0) {
      listContainer.innerHTML = `<div class="ai-suggestion">ูุง ุชูุฌุฏ ุงูุชุฑุงุญุงุช ุญุงููุงู</div>`;
      return;
    }

    data.forEach(item => {
      const div = document.createElement('div');
      div.className = 'ai-suggestion';
      div.textContent = item.suggestion_text;
      listContainer.appendChild(div);
    });
  })
  .catch(err => {
    console.error("ุฎุทุฃ ูู ุฌูุจ ุงูุชุฑุงุญุงุช AI:", err);
    const listContainer = document.getElementById('aiSuggestionsList');
    listContainer.innerHTML = `<div class="ai-suggestion error">โ๏ธ ูู ูุชููู ูู ุชุญููู ุงูุงูุชุฑุงุญุงุช.</div>`;
  });

</script>



<script>
  fetch(`${API_BASE_URL}/resources/`, {
    method: 'GET',
    headers: {
      'Authorization': 'Bearer ' + token,
      'Content-Type': 'application/json'
    }
  })
  .then(res => {
    if (!res.ok) {
      throw new Error("ูุดู ูู ุชุญููู ุงูููุงุฑุฏ ุงูููุณูุฉ");
    }
    return res.json();
  })
  .then(data => {
    const resourcesList = document.getElementById('resourcesList');
    resourcesList.innerHTML = '';

    if (data.length === 0) {
      resourcesList.innerHTML = `<div class="resource-card">ูุง ุชูุฌุฏ ููุงุฑุฏ ุญุงููุงู</div>`;
      return;
    }

    data.forEach(resource => {
      const card = document.createElement('div');
      card.className = 'resource-card';
      card.tabIndex = 0;
      card.innerHTML = `
        <h3>${resource.title}</h3>
        <p>${resource.description}</p>
        ${resource.url ? `<a href="${resource.url}" target="_blank">ุนุฑุถ ุงููุตุฏุฑ</a>` : ''}
      `;
      resourcesList.appendChild(card);
    });
  })
  .catch(err => {
    console.error("ุฎุทุฃ ูู ุฌูุจ ุงูููุงุฑุฏ:", err);
    const resourcesList = document.getElementById('resourcesList');
    resourcesList.innerHTML = `<div class="resource-card error">โ๏ธ ูู ูุชููู ูู ุชุญููู ุงูููุงุฑุฏ.</div>`;
  });
</script>





<script>
document.addEventListener("DOMContentLoaded", function () {
  const token = localStorage.getItem("access");
  const listContainer = document.getElementById("aiSuggestionsList");

  fetch(`${API_BASE_URL}/suggestions/`, {
    method: 'GET',
    headers: {
      'Authorization': 'Bearer ' + token,
      'Content-Type': 'application/json'
    }
  })
  .then(res => res.json())
  .then(data => {
    listContainer.innerHTML = "";

    if (data.length === 0) {
      listContainer.innerHTML = `<div class="ai-suggestion">ูุง ุชูุฌุฏ ุชูุตูุงุช ุญุงููุงู.</div>`;
      return;
    }

    const sourceMap = {
      mood: "ุจูุงุกู ุนูู ุงููุฒุงุฌ",
      chat: "ุจูุงุกู ุนูู ุงููุญุงุฏุซุฉ",
      manual: "ูุฏุฎูุฉ ูุฏูููุง"
    };

    data.forEach(item => {
      const suggestion = document.createElement('div');
      suggestion.className = 'ai-suggestion';
      suggestion.innerHTML = `
        <p><strong>๐ก ุงูุชูุตูุฉ:</strong> ${item.suggestion_text}</p>
        <p><strong>๐ ุงููุตุฏุฑ:</strong> ${sourceMap[item.source_type] || 'ุบูุฑ ูุนุฑูู'}</p>
        <p><strong>๐ ุงูุชุงุฑูุฎ:</strong> ${new Date(item.generated_at).toLocaleString('ar-EG')}</p>
        <hr>
      `;
      listContainer.appendChild(suggestion);
    });
  })
  .catch(err => {
    console.error("โ๏ธ ูุดู ูู ุชุญููู ุงูุชูุตูุงุช:", err);
    listContainer.innerHTML = `<div class="ai-suggestion error">โ๏ธ ูู ูุชููู ูู ุชุญููู ุงูุชูุตูุงุช.</div>`;
  });
});
</script>


<script>
  document.addEventListener("DOMContentLoaded", function () {
  const token = localStorage.getItem("access");
  const aiLogList = document.getElementById("aiLogList");

  fetch(`${API_BASE_URL}/mood-logs/`, {
    method: "GET",
    headers: {
      "Authorization": "Bearer " + token
    }
  })
  .then(res => res.json())
  .then(data => {
    aiLogList.innerHTML = "";
    if (data.length === 0) {
      aiLogList.innerHTML = "<p>ูุง ุชูุฌุฏ ุณุฌูุงุช ูุฒุงุฌ ุญุงููุงู.</p>";
      return;
    }

    data.forEach(log => {
      const entry = document.createElement("div");
      entry.classList.add("mood-log-entry");
      entry.innerHTML = `
        <p><strong>๐ง ุงููุฒุงุฌ:</strong> ${log.mood}</p>
        ${log.notes ? `<p><strong>๐ ููุงุญุธุงุช:</strong> ${log.notes}</p>` : ''}
        <p><strong>โฑ๏ธ ุงูุชุงุฑูุฎ:</strong> ${new Date(log.created_at).toLocaleString('ar-EG')}</p>
        <hr>
      `;
      aiLogList.appendChild(entry);
    });
  })
  .catch(err => {
    aiLogList.innerHTML = "<p style='color:red;'>โ๏ธ ูุดู ูู ุชุญููู ุณุฌู ุงููุฒุงุฌ</p>";
    console.error(err);
  });
});

</script>


</body>
</html>
